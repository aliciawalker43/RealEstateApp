<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Maintenance Request View</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
	<link rel="stylesheet" th:href="@{/css/saas-dashboard.css}">
	<link rel="stylesheet" th:href="@{/css/company-theme.css}">
</head>
<body class="bg-light">
	<th:block th:replace="~{fragments/navbar :: navbar}"></th:block>
	<th:block th:replace="~{fragments/company-sidebar :: sidebar}"></th:block> 
	
<div class="container p-4 py-4">
    <div class="dashboard-hero mb-4">
        <div class="d-flex align-items-center justify-content-between flex-wrap">
            <div>
                <p class="mb-1 text-white-50"><i class="fa-solid fa-screwdriver-wrench"></i> Maintenance</p>
                <h2 class="fw-bold mb-1"><h2 th:text="${company.name}">Dashboard</h2>
                <p class="mb-0">View maintenance request by property.</p>
			 </div>
		</div>
	</div>
 </div>
		
 
 <div class="container p-4 py-4">
			<h3> Maintenance Requests List</h3>
			
			
			<div th:if="${requests == null or requests.isEmpty()}"
			     class="text-center text-muted py-5">
			  <h5>No maintenance requests at this time</h5>
			  <p class="small">When tenants submit requests, they will appear here.</p>
			</div>

			<div th:if="${requests != null and !requests.isEmpty()}">
			<div th:each="req : ${requests}" class="card p-3 mb-3" >

			  <div class="d-flex justify-content-between">
			    <div>
			      <h5 class="mb-1" th:text="${req.title}">Leaking faucet</h5>
			      <div class="text-muted small">
			        Tenant:
			        <span th:text="${req.user.firstname + ' ' + req.user.lastname}">Tenant Name</span>
			        •
			        <span th:text="${req.property != null ? req.property.rentalAddress : 'Unassigned'}">Address</span>
			      </div>
			    </div>

            
				
				
						


<form th:action="@{'/landlord/maintenance/update-status/' + ${req.id}}" method="post" style="display:inline;">
	<input type="hidden" th:name="id" th:value="${req.id}"/>
	<select name="status"
           class="form-select form-select-sm d-inline w-auto"
               onchange="this.form.submit()">
			   <option  th:text="${req.status}"></span>
			      </option>
        <option th:value="OPEN" th:selected="${req.status == 'OPEN'}">OPEN</option>
        <option th:value="IN_PROGRESS" th:selected="${req.status == 'IN_PROGRESS'}">IN PROGRESS</option>
        <option th:value="CLOSED" th:selected="${req.status == 'CLOSED'}">CLOSED</option>
    </select>
</form></span>

			  </div>

			  <p class="mt-2 mb-2" th:text="${req.description}">Description...</p>

			  
			  <!-- Images -->
			  <div class="row g-2">
			  <div class="col-4"  
			      th:each ="imgs : ${req.imageAssets}">
				   
				   <a th:href="@{${imgs.storagePath}}" target="_blank">
				      <img class="img-fluid rounded"
				           style="max-height: 100px; object-fit: cover;"
				           th:src="@{${imgs.storagePath}}"
				           alt="Maintenance photo"/>
				    </a>
			    </div>
			  </div>
	            <div class="text-muted small mt-2">
                    Submitted on: <span th:text="${req.createdAt!= null ? #temporals.format(req.createdAt, 'yyyy-MM-dd') : '—'}">Date</td>
			</div>
</div>
            </div>
			</div>
	</div>
	<th:block th:replace="~{fragments/footer :: footer}"></th:block>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
	</html>