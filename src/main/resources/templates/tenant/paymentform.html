<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
	<title>Tenant Payment Form</title>
	   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
	   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

	   <script src="https://js.stripe.com/v3/"></script>

	 <link rel="stylesheet" th:href="@{/css/company-theme.css}">
	   <link rel="stylesheet" th:href="@{/css/saas-dashboard.css}">
</head>
<body class="body">
	
	<th:block th:replace="~{fragments/navbar :: navbar}"></th:block>
	<th:block th:replace="~{fragments/tenant-sidebar :: sidebar}"></th:block>
	<p th:if="${error}" th:text="${error}"></p>
	<p th:if="${success}" th:text="${success}"></p>

	<div class="container p-4 py-4">
	 <div class="dashboard-hero mb-4">
	 <div class="d-flex align-items-center justify-content-between flex-wrap">	
	        <h1><i class="fa-solid fa-cash-register"></i>  Submit Rent Payment</h1>
	        <p>Make a secure rent payment at your convenience.</p>
	    </div>
	    <a th:href="@{/tenant/dashboard}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
	</header>

	</div>
	</div>
	
	<!--  Profile Summary Card -->
					<div class="card mb-4 shadow-sm">
					  <div class="btn btn-primary text-white">
					    <h5 class="mb-0">Rental Overview</h5>
					  </div>
					  <div class="card-body">
					    <div class="column text-center">
					      <div class="col-md-3 mb-2">
					        <div class="fw-semibold text-muted">Property</div>
					        <div th:text="${tenant.property.rentalAddress}">Name</div>
					      </div>
						  <div class="col-md-3 mb-2">
						  	<div class="fw-semibold text-muted">Name</div>
						  	 <div th:text="${tenant.user.firstname}+ ' ' +${tenant.user.lastname}"> Name</div>
						  	 </div>
					      <div class="col-md-3 mb-2">
					        <div class="fw-semibold text-muted">Email</div>
					        <div th:text="${tenant.user.email}">Email</div>
					      </div>
						  
						  <div class="col-md-3 mb-2">
						  	<div class="fw-semibold text-muted">Rent Due Day</div>
						  	 <div th:text="${tenant.property.rentDueDay}">Rent Due Day</div>
						  	</div>
							
							<div class="col-md-3 mb-2">
							<div class="fw-semibold text-muted">Rent Amount</div>
							 <div th:text="${tenant.property.rentAmount}">Rent Amount</div>
							</div>
							
							<div class="col-md-3 mb-2">
							    <div class="fw-semibold text-muted">Lease Start Date</div>
							    <div th:text="${tenant.property.leaseStartDate}">Rent Amount</div>
								</div>
					  
					    </div>
					  </div>
					</div>
	
	
	
	
	<!--payment form-->
	
	<div class="row justify-content-center mt-4">
		  <div class="col-12 col-md-6 col-lg-4">

		    <div class="card shadow-sm">
		      <div class="card-body p-4">

				<div>
				  <h1 class="h5 mb-1">Make a Payment</h1>
				  <div class="text-muted small">Choose amount and payment method</div>
				</div>
<br>

<form th:action="@{/tenant/makepayment}" method="post">
  <div class="mb-3">
    <label>Amount Due: $<span th:text="${amountDue}"></span></label><br>
    <input class="form-control" type="hidden" name="amountDue" th:value="${amountDue}" />
  </div>

  <div class="mb-3">
    <input class="btn-check" type="radio" name="paymentAmount" th:value="${amountDue}" id="payFull" checked>
    <label class="btn btn-outline-primary w-100 text-start p-3" for="payFull">
      <div class="fw-bold">Pay in Full</div>
      <div class="fw-semibold">Amount Due: $<span th:text="${amountDue}"></span></div>
      <div class="text-muted small">This includes past due amount of $<span th:text="${pastDue}"></span></div>
    </label>
  </div>

  <div class="mb-3">
    <input class="btn-check" type="radio" name="paymentAmount"  id="payPartial">
    <label class="btn btn-outline-primary w-100 text-start p-3" for="payPartial">
      <div class="fw-bold">Partial Payment</div>
      <div class="small text-muted">example: $200.00</div>
    </label>
  </div>

  <div id="partialAmountDiv" class="mb-3" style="display: none;">
    <input class="form-control" type="number" min="1" step="0.01" name="partialAmount" placeholder="Enter partial amount">
  </div>
  <br>

  <div class="mb-3">
    <label class="form-label fw-semibold">
      <i class="fa-solid fa-coins me-1"></i> Select Currency
    </label>
    <select name="currency" required>
      <option value="">Select Currency</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
      <option value="GBP">GBP</option>
      <option value="CAD">CAD</option>
      <option value="AUD">AUD</option>
    </select>
  </div>

  <div class="mb-3">
    <input class="btn-check" type="radio" name="method" value="PAYPAL" id="payPal">
    <label class="btn btn-outline-primary w-100 text-start p-3" for="payPal">
      <img th:src="@{/images/paypalbutton.png}" alt="PayPal" width="250px">
      <span>PayPal</span>
    </label>
  </div>

  <div class="mb-3">
    <input class="btn-check" type="radio" name="method" value="STRIPE" id="stripe">
    <label class="btn btn-outline-primary w-100 text-start p-3" for="stripe">
      <img th:src="@{/images/stripecardlogo.png}" alt="Card" width="250px">
      <strong>Debit / Credit Card</strong>
    </label>
  </div>

  <input type="hidden" id="intent" name="intent" value="AUTHORIZE">

  <div class="mb-3">
    <label class="form-label fw-semibold">
      <i class="fa-solid fa-note-sticky me-1"></i> Note (optional)
    </label>
    <input type="text" class="form-control" name="note" placeholder="Example: January rent">
  </div>

  <div class="form-text">
    Stripe checkout will open on the next screen.
  </div>

  <div class="mb-3">
    <button class="btn btn-primary" type="submit">
      <i class="fa-solid fa-lock me-1"></i> Continue to Secure Checkout
    </button>
    <div class="text-muted small mt-2">
      <i class="fa-solid fa-shield-halved me-1"></i>
      Payments are processed securely by Stripe or PayPal.
    </div>
  </div>
</form>

 </div>
	  
	</div>
  </div>
</div>


<!--Handle Radio Selections-->

<script>
  document.addEventListener("DOMContentLoaded", function () {

    // Payment type radios
    const payFull = document.getElementById("payFull");
    const payPartial = document.getElementById("payPartial");
    const partialDiv = document.getElementById("partialAmountDiv");
    const partialInput = partialDiv.querySelector("input");

    // Payment method radios
    const methodRadios = document.querySelectorAll("input[name='method'], input[name='paymentAmount']");
    const methodLabels = document.querySelectorAll("label[for='payFull'], label[for='payPartial'], label[for='payPal'], label[for='stripe']");
	
	

    function togglePartialAmount() {
      if (payPartial.checked) {
        partialDiv.style.display = "block";
        partialInput.required = true;
		partialInput.disabled = false;
		partialInput.tabIndex = 0;
		partialInput.removeAttribute("aria-hidden");
      } else {
        partialDiv.style.display = "none";
        partialInput.required = false;
		partialInput.disabled = true;
        partialInput.value = 0;
		partialInput.tabIndex = -1;
		partialInput.setAttribute("aria-hidden", "true");
      }
    }

    function highlightPaymentMethod() {
      methodLabels.forEach(label => label.classList.remove("selected"));

      methodRadios.forEach(radio => {
        if (radio.checked) {
          radio.closest("label")?.classList.add("selected");
        }
      });
    }

    // Attach listeners
    payFull.addEventListener("change", togglePartialAmount);
    payPartial.addEventListener("change", togglePartialAmount);

    methodRadios.forEach(radio => {
      radio.addEventListener("change", highlightPaymentMethod);
    });

    // Initial state
    togglePartialAmount();
    highlightPaymentMethod();
  });
  


</script>


</body>
</html>